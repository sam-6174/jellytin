---
version: '3.4'

services:
  cloudflared-chown:
    # https://github.com/cloudflare/cloudflared/issues/163
    image: privatebin/chown:$CHOWN_TAG
    read_only: true
    command: 65532:65532 /mnt
    volumes:
      - cloudflared_certs:/mnt
  cloudflared:
    image: cloudflare/cloudflared:$CLOUDFLARED_TAG
    restart: unless-stopped
    depends_on:
      - cloudflared-chown
    command: tunnel --no-autoupdate run
    volumes:
      - ./mounts/cloudflared/:/etc/cloudflared
      - cloudflared_certs:/home/nonroot/.cloudflared/
    networks:
      - cloudflared
volumes:
  cloudflared_certs:
    driver: local
networks:
  cloudflared:
    name: cloudflared
